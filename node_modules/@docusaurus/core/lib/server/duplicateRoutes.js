"use strict";
/**
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.handleDuplicateRoutes = void 0;
const utils_1 = require("@docusaurus/utils");
const utils_2 = require("./utils");
function getAllDuplicateRoutes(pluginsRouteConfigs) {
    const allRoutes = (0, utils_2.getAllFinalRoutes)(pluginsRouteConfigs).map((routeConfig) => routeConfig.path);
    const seenRoutes = new Set();
    return allRoutes.filter((route) => {
        if (seenRoutes.has(route)) {
            return true;
        }
        seenRoutes.add(route);
        return false;
    });
}
function getDuplicateRoutesMessage(allDuplicateRoutes) {
    const message = allDuplicateRoutes
        .map((duplicateRoute) => `- Attempting to create page at ${duplicateRoute}, but a page already exists at this route.`)
        .join('\n');
    return message;
}
function handleDuplicateRoutes(pluginsRouteConfigs, onDuplicateRoutes) {
    if (onDuplicateRoutes === 'ignore') {
        return;
    }
    const duplicatePaths = getAllDuplicateRoutes(pluginsRouteConfigs);
    const message = getDuplicateRoutesMessage(duplicatePaths);
    if (message) {
        const finalMessage = `Duplicate routes found!
${message}
This could lead to non-deterministic routing behavior.`;
        (0, utils_1.reportMessage)(finalMessage, onDuplicateRoutes);
    }
}
exports.handleDuplicateRoutes = handleDuplicateRoutes;
