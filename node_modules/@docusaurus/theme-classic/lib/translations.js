"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getTranslationFiles = getTranslationFiles;
exports.translateThemeConfig = translateThemeConfig;

var _lodash = _interopRequireDefault(require("lodash"));

var _utils = require("@docusaurus/utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
function getNavbarTranslationFile(navbar) {
  // TODO handle properly all the navbar item types here!
  function flattenNavbarItems(items) {
    const subItems = items.flatMap(item => {
      const allSubItems = [item.items ?? []].flat();
      return flattenNavbarItems(allSubItems);
    });
    return [...items, ...subItems];
  }

  const allNavbarItems = flattenNavbarItems(navbar.items);
  const navbarItemsTranslations = Object.fromEntries(allNavbarItems.filter(navbarItem => navbarItem.label).map(navbarItem => [`item.label.${navbarItem.label}`, {
    message: navbarItem.label,
    description: `Navbar item with label ${navbarItem.label}`
  }]));
  const titleTranslations = navbar.title ? {
    title: {
      message: navbar.title,
      description: 'The title in the navbar'
    }
  } : {};
  return (0, _utils.mergeTranslations)([titleTranslations, navbarItemsTranslations]);
}

function translateNavbar(navbar, navbarTranslations) {
  var _navbarTranslations$t;

  if (!navbarTranslations) {
    return navbar;
  }

  return { ...navbar,
    title: ((_navbarTranslations$t = navbarTranslations.title) === null || _navbarTranslations$t === void 0 ? void 0 : _navbarTranslations$t.message) ?? navbar.title,
    //  TODO handle properly all the navbar item types here!
    items: navbar.items.map(item => {
      var _item$items, _navbarTranslations$2;

      const subItems = (_item$items = item.items) === null || _item$items === void 0 ? void 0 : _item$items.map(subItem => {
        var _navbarTranslations$;

        return { ...subItem,
          label: ((_navbarTranslations$ = navbarTranslations[`item.label.${subItem.label}`]) === null || _navbarTranslations$ === void 0 ? void 0 : _navbarTranslations$.message) ?? subItem.label
        };
      });
      return { ...item,
        label: ((_navbarTranslations$2 = navbarTranslations[`item.label.${item.label}`]) === null || _navbarTranslations$2 === void 0 ? void 0 : _navbarTranslations$2.message) ?? item.label,
        ...(subItems ? {
          items: subItems
        } : undefined)
      };
    })
  };
}

function isMultiColumnFooterLinks(links) {
  return links.length > 0 && 'title' in links[0];
}

function getFooterTranslationFile(footer) {
  const footerLinkTitles = Object.fromEntries((isMultiColumnFooterLinks(footer.links) ? footer.links.filter(link => link.title) : []).map(link => [`link.title.${link.title}`, {
    message: link.title,
    description: `The title of the footer links column with title=${link.title} in the footer`
  }]));
  const footerLinkLabels = Object.fromEntries((isMultiColumnFooterLinks(footer.links) ? footer.links.flatMap(link => link.items).filter(link => link.label) : footer.links.filter(link => link.label)).map(link => [`link.item.label.${link.label}`, {
    message: link.label,
    description: `The label of footer link with label=${link.label} linking to ${link.to ?? link.href}`
  }]));
  const copyright = footer.copyright ? {
    copyright: {
      message: footer.copyright,
      description: 'The footer copyright'
    }
  } : {};
  return (0, _utils.mergeTranslations)([footerLinkTitles, footerLinkLabels, copyright]);
}

function translateFooter(footer, footerTranslations) {
  var _footerTranslations$c;

  if (!footerTranslations) {
    return footer;
  }

  const links = isMultiColumnFooterLinks(footer.links) ? footer.links.map(link => {
    var _footerTranslations$;

    return { ...link,
      title: ((_footerTranslations$ = footerTranslations[`link.title.${link.title}`]) === null || _footerTranslations$ === void 0 ? void 0 : _footerTranslations$.message) ?? link.title,
      items: link.items.map(linkItem => {
        var _footerTranslations$2;

        return { ...linkItem,
          label: ((_footerTranslations$2 = footerTranslations[`link.item.label.${linkItem.label}`]) === null || _footerTranslations$2 === void 0 ? void 0 : _footerTranslations$2.message) ?? linkItem.label
        };
      })
    };
  }) : footer.links.map(link => {
    var _footerTranslations$3;

    return { ...link,
      label: ((_footerTranslations$3 = footerTranslations[`link.item.label.${link.label}`]) === null || _footerTranslations$3 === void 0 ? void 0 : _footerTranslations$3.message) ?? link.label
    };
  });
  const copyright = ((_footerTranslations$c = footerTranslations.copyright) === null || _footerTranslations$c === void 0 ? void 0 : _footerTranslations$c.message) ?? footer.copyright;
  return { ...footer,
    links,
    copyright
  };
}

function getTranslationFiles({
  themeConfig
}) {
  const translationFiles = [{
    path: 'navbar',
    content: getNavbarTranslationFile(themeConfig.navbar)
  }, themeConfig.footer ? {
    path: 'footer',
    content: getFooterTranslationFile(themeConfig.footer)
  } : undefined];
  return translationFiles.filter(Boolean);
}

function translateThemeConfig({
  themeConfig,
  translationFiles
}) {
  var _translationFilesMap$, _translationFilesMap$2;

  const translationFilesMap = _lodash.default.keyBy(translationFiles, f => f.path);

  return { ...themeConfig,
    navbar: translateNavbar(themeConfig.navbar, (_translationFilesMap$ = translationFilesMap.navbar) === null || _translationFilesMap$ === void 0 ? void 0 : _translationFilesMap$.content),
    footer: themeConfig.footer ? translateFooter(themeConfig.footer, (_translationFilesMap$2 = translationFilesMap.footer) === null || _translationFilesMap$2 === void 0 ? void 0 : _translationFilesMap$2.content) : undefined
  };
}